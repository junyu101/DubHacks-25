<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daydreamer - AI Story Studio</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌙</text></svg>">
    <style>
        :root {
            /* Enhanced Childlike Color Palette */
            --sky-blue: #5DC1FF;
            --crayon-pink: #FF69B4;
            --sunshine-yellow: #FFE135;
            --lavender-dreams: #C9A0FF;
            --cloud-white: #FFFFFF;
            --paper-cream: #FFFDD0;
            --star-gold: #FFD700;
            --fun-green: #4ADE80;
            --bubble-purple: #A78BFA;
            --midnight-ink: #1E3A5F;
            --soft-shadow: rgba(30, 58, 95, 0.1);
            
            /* Enhanced Gradients */
            --twilight-dreams: linear-gradient(135deg, var(--lavender-dreams) 0%, var(--sky-blue) 100%);
            --sunrise-wonder: linear-gradient(135deg, var(--sunshine-yellow) 0%, var(--crayon-pink) 50%, #FFB347 100%);
            --midnight-magic: linear-gradient(135deg, var(--midnight-ink) 0%, #2C5F8D 100%);
            
            /* Confetti Colors */
            --confetti-colors: #FFD700, #FF69B4, #5DC1FF, #C9A0FF, #4ADE80, #FFE135;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px var(--soft-shadow);
            --shadow-md: 0 4px 6px var(--soft-shadow);
            --shadow-lg: 0 10px 15px var(--soft-shadow);
            --shadow-card: 0 4px 20px var(--soft-shadow);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--twilight-dreams);
            color: var(--midnight-ink);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.8s ease;
        }
        
        .hidden {
            display: none !important;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }
        

        
        /* Navigation */
        .nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--soft-shadow);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--midnight-ink);
            text-decoration: none;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: transform 0.3s ease;
        }
        
        .logo:hover {
            transform: scale(1.1);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: var(--space-lg);
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--midnight-ink);
            font-weight: 500;
            transition: color 0.3s ease;
            cursor: pointer;
        }
        
        .nav-links a:hover {
            color: var(--sky-blue);
        }
        
        .cta-btn {
            background: var(--crayon-pink);
            color: var(--midnight-ink);
            padding: var(--space-xs) var(--space-md);
            border: none;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            font-family: 'Baloo 2', cursive;
        }
        
        .cta-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.4);
            animation: bounce 0.6s ease;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-2px) scale(1.05); }
            50% { transform: translateY(-8px) scale(1.1); }
        }
        
        /* Enhanced Input Focus Effects */
        .story-input-field:focus {
            border-color: var(--crayon-pink);
            box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.3), 
                        0 0 20px rgba(255, 105, 180, 0.2) !important;
            animation: inputGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes inputGlow {
            from { box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.3), 0 0 20px rgba(255, 105, 180, 0.2); }
            to { box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.5), 0 0 30px rgba(255, 105, 180, 0.4); }
        }
        
        /* Enhanced Empty States */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--midnight-ink);
            opacity: 0.8;
            animation: emptyStateBounce 3s ease-in-out infinite;
        }
        
        @keyframes emptyStateBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .empty-state h3 {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
            font-family: 'Fredoka One', cursive;
        }
        
        /* Landing Page */
        .landing {
            padding-top: 80px;
        }
        
        .hero {
            background: var(--twilight-dreams);
            color: var(--midnight-ink);
            text-align: center;
            padding: var(--space-xl) 0;
            position: relative;
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Fredoka One', cursive;
            letter-spacing: 0.02em;
        }
        
        h1 {
            font-family: 'Fredoka One', cursive;
        }
        
        h2, h3 {
            font-family: 'Baloo 2', cursive;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: var(--space-sm);
            background: linear-gradient(45deg, var(--midnight-ink), var(--sky-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero p {
            font-size: 1.25rem;
            margin-bottom: var(--space-lg);
            opacity: 0.8;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .hero-cta {
            background: var(--star-gold);
            color: var(--midnight-ink);
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }
        
        .hero-cta:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        /* Features Section */
        .features {
            padding: var(--space-xl) 0;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .features h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: var(--space-xl);
            color: var(--midnight-ink);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-lg);
        }
        
        .feature-card {
            background: var(--cloud-white);
            padding: var(--space-lg);
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow-card);
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            border-color: var(--crayon-pink);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: var(--space-sm);
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: var(--space-sm);
            color: var(--midnight-ink);
        }
        
        /* App Pages */
        .app-page {
            padding-top: 80px;
            min-height: 100vh;
            background: var(--twilight-dreams);
        }
        
        .page-header {
            background: rgba(255, 255, 255, 0.95);
            padding: var(--space-lg) 0;
            border-bottom: 1px solid var(--soft-shadow);
            backdrop-filter: blur(10px);
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--midnight-ink);
            margin-bottom: var(--space-xs);
        }
        
        .page-subtitle {
            color: var(--sky-blue);
            font-size: 1.1rem;
            font-style: italic;
        }
        
        /* Story Library */
        .story-library {
            padding: var(--space-lg) 0;
        }
        
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
            gap: var(--space-md);
        }
        
        .new-story-btn {
            background: var(--star-gold);
            color: var(--midnight-ink);
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }
        
        .new-story-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-lg);
        }
        
        .story-card {
            background: var(--cloud-white);
            border-radius: 16px;
            padding: var(--space-lg);
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .story-card:hover {
            transform: translateY(-5px);
            border-color: var(--lavender-dreams);
            box-shadow: var(--shadow-lg);
        }
        
        .story-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--midnight-ink);
            margin-bottom: var(--space-xs);
        }
        
        .story-seed {
            font-style: italic;
            color: var(--sky-blue);
            margin-bottom: var(--space-sm);
            font-size: 0.95rem;
        }
        
        .story-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
            font-size: 0.85rem;
            color: #666;
        }
        
        .story-actions {
            display: flex;
            gap: var(--space-sm);
        }
        
        .continue-btn {
            background: var(--crayon-pink);
            color: var(--midnight-ink);
            padding: var(--space-xs) var(--space-md);
            border: none;
            border-radius: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .continue-btn:hover {
            background: var(--sky-blue);
            color: white;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            background: #ffebee;
            color: #f44336;
        }
        
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--midnight-ink);
            opacity: 0.7;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: var(--space-sm);
        }
        
        /* Story Studio (Chat Interface) */
        .story-studio {
            display: flex;
            height: calc(100vh - 80px);
        }
        
        .studio-header {
            background: rgba(255, 255, 255, 0.95);
            padding: var(--space-md);
            border-bottom: 1px solid var(--soft-shadow);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            backdrop-filter: blur(10px);
        }
        
        .back-btn {
            background: var(--lavender-dreams);
            color: var(--midnight-ink);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .back-btn:hover {
            background: var(--crayon-pink);
            transform: scale(1.1);
        }
        
        .studio-title {
            flex: 1;
        }
        
        .studio-title h2 {
            font-size: 1.3rem;
            color: var(--midnight-ink);
            margin-bottom: 2px;
        }
        
        .studio-seed {
            font-size: 0.9rem;
            color: var(--sky-blue);
            font-style: italic;
        }
        
        .studio-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .story-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .message {
            max-width: 80%;
            padding: var(--space-sm) var(--space-md);
            border-radius: 18px;
            animation: messageSlideIn 0.4s ease-out;
            position: relative;
        }
        
        @keyframes messageSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--crayon-pink);
            color: var(--midnight-ink);
            margin-left: auto;
        }
        
        .message.ai {
            align-self: flex-start;
            background: var(--lavender-dreams);
            color: var(--midnight-ink);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .message.ai::after {
            content: '✨';
            position: absolute;
            right: -10px;
            top: -10px;
            animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .typing-indicator {
            align-self: flex-start;
            background: var(--cloud-white);
            padding: var(--space-md);
            border-radius: 18px;
            box-shadow: var(--shadow-sm);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
            justify-content: center;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--sky-blue);
            animation: typing 1.4s ease-in-out infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .story-input {
            background: rgba(255, 255, 255, 0.95);
            padding: var(--space-md);
            border-top: 1px solid var(--soft-shadow);
            display: flex;
            gap: var(--space-sm);
            align-items: flex-end;
            backdrop-filter: blur(10px);
        }
        
        .story-input-field {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            border: 2px solid var(--lavender-dreams);
            border-radius: 25px;
            outline: none;
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            background: var(--cloud-white);
        }
        
        .story-input-field:focus {
            border-color: var(--crayon-pink);
            box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.3);
        }
        
        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            background: var(--star-gold);
            color: var(--midnight-ink);
        }
        
        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }
        
        /* Paper Airplane Animation */
        @keyframes paperAirplane {
            0% {
                transform: translateX(0) translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateX(200px) translateY(-100px) rotate(45deg);
                opacity: 0;
            }
        }
        
        .airplane-animation {
            position: fixed;
            font-size: 1.5rem;
            pointer-events: none;
            z-index: 1001;
            animation: paperAirplane 1s ease-out forwards;
        }
        
        /* Achievements Panel */
        .achievements-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-card);
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }
        
        .achievement {
            background: var(--cloud-white);
            padding: var(--space-sm);
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .achievement.unlocked {
            background: var(--star-gold);
            color: var(--midnight-ink);
            transform: scale(1.05);
            border-color: var(--crayon-pink);
        }
        
        .achievement.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        
        .achievement-icon {
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
        }
        
        .achievement-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }
        
        .achievement-desc {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: var(--cloud-white);
            padding: var(--space-xl);
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-50px) scale(0.9); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--midnight-ink);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .close-btn:hover {
            color: var(--midnight-ink);
        }
        
        .form-group {
            margin-bottom: var(--space-md);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 600;
            color: var(--midnight-ink);
        }
        
        .form-input, .form-textarea {
            width: 100%;
            padding: var(--space-sm);
            border: 2px solid var(--lavender-dreams);
            border-radius: 8px;
            outline: none;
            font-family: inherit;
            font-size: 1rem;
        }
        
        .form-input:focus, .form-textarea:focus {
            border-color: var(--crayon-pink);
            box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.3);
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn-primary {
            background: var(--star-gold);
            color: var(--midnight-ink);
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--lavender-dreams);
            color: var(--midnight-ink);
            padding: var(--space-sm) var(--space-lg);
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: var(--crayon-pink);
        }
        
        /* Success Animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1500;
        }
        
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: confetti-fall 3s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Enhanced Theme Variations */
        .theme-sunrise {
            background: var(--sunrise-wonder) !important;
        }
        
        .theme-sunrise .hero {
            background: var(--sunrise-wonder) !important;
        }
        
        .theme-sunrise .app-page {
            background: var(--sunrise-wonder) !important;
        }
        
        .theme-midnight {
            background: var(--midnight-magic) !important;
            color: var(--cloud-white);
        }
        
        .theme-midnight .hero {
            background: var(--midnight-magic) !important;
        }
        
        .theme-midnight .app-page {
            background: var(--midnight-magic) !important;
        }
        
        .theme-midnight .nav {
            background: rgba(30, 58, 95, 0.95);
        }
        
        .theme-midnight .nav, 
        .theme-midnight .logo,
        .theme-midnight .nav-links a {
            color: var(--cloud-white);
        }
        

        

        

        
        .mood-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            animation: modalFadeIn 0.5s ease;
        }
        
        .mood-content {
            background: var(--cloud-white);
            padding: 40px;
            border-radius: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 3001;
            animation: modalBounceIn 0.6s ease;
        }
        
        .mood-emojis {
            display: grid;
            grid-template-columns: repeat(5, 60px);
            gap: 12px;
            justify-content: center;
            margin: 24px auto;
            max-width: 500px;
            padding: 20px;
        }
        
        .mood-emoji {
            width: 60px;
            height: 60px;
            background: #FAFAFF;
            border: 3px solid #E6E6FA;
            border-radius: 12px;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .mood-emoji:hover {
            transform: scale(1.2);
            border-color: var(--crayon-pink);
            background: rgba(255, 105, 180, 0.1);
        }
        
        .mood-emoji.selected {
            transform: scale(1.3);
            border-color: var(--star-gold);
            background: rgba(255, 215, 0, 0.2);
            animation: sparkle 1s ease-in-out infinite;
        }
        
        .mood-note {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid var(--lavender-dreams);
            border-radius: 16px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            resize: none;
            min-height: 80px;
            box-sizing: border-box;
        }
        
        .mood-note:focus {
            border-color: var(--crayon-pink);
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.3);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .stories-grid {
                grid-template-columns: 1fr;
            }
            
            .library-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .story-studio {
                flex-direction: column;
            }
            
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        *:focus {
            outline: 2px solid var(--star-gold);
            outline-offset: 2px;
        }
        
        button:focus, input:focus, textarea:focus {
            outline: 2px solid var(--crayon-pink);
        }
    </style>
</head>
<body>


    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="logo" onclick="showPage('landing')" id="logo">Daydreamer.ai 🌙</div>
            <ul class="nav-links" id="nav-links">
                <li><a onclick="showPage('landing')">Home</a></li>
                <li><a onclick="showPage('library')" class="hidden" id="nav-library">Story Library</a></li>
                <li><a onclick="showPage('achievements')" class="hidden" id="nav-achievements">Achievements</a></li>
                <li><a onclick="showPage('settings')" class="hidden" id="nav-settings">Settings</a></li>
            </ul>
            <button class="cta-btn" onclick="startFirstStory()" id="cta-button">Start Dreaming</button>
            <div class="hidden" id="user-greeting"></div>
        </div>
    </nav>

    <!-- Landing Page -->
    <div id="landing-page" class="landing">
        <section class="hero">
            <div class="hero-content container">
                <h1>Welcome to Daydreamer.ai 🌙</h1>
                <p>Collaborate with AI to weave new worlds. Every great story starts with a daydream.</p>
                <button class="hero-cta" onclick="startFirstStory()">Start a New Story</button>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <h2>Your Creative Playground</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">📖</div>
                        <h3>AI Story Collaboration</h3>
                        <p>Write stories together with an intelligent AI companion that builds on your ideas and brings new creative directions to your tales.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">☁️</div>
                        <h3>Story Library</h3>
                        <p>Keep all your creative works organized in your personal story library. Continue multiple adventures whenever inspiration strikes.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🏆</div>
                        <h3>Creative Achievements</h3>
                        <p>Unlock badges and track your writing streaks as you build your skills and explore new worlds of imagination.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Story Library Page -->
    <div id="library-page" class="app-page hidden">
        <div class="page-header">
            <div class="container">
                <h1 class="page-title">Your Story Canvas</h1>
                <p class="page-subtitle">Where imagination takes flight</p>
            </div>
        </div>
        <div class="story-library">
            <div class="container">
                <div class="library-header">
                    <div class="achievements-panel">
                        <h3>✨ Recent Achievements</h3>
                        <div class="achievements-grid" id="recent-achievements">
                            <!-- Recent achievements will be populated here -->
                        </div>
                    </div>
                    <button class="new-story-btn btn-bounce" onclick="openNewStoryModal()">+ New Story</button>
                </div>
                
                <div id="stories-container">
                    <div class="empty-state" id="empty-state">
                        <h3>🌟 Your story canvas awaits...</h3>
                        <p>Begin your first daydream and watch your imagination come to life!</p>
                        <button class="new-story-btn" onclick="openNewStoryModal()" style="margin-top: var(--space-md);">Create Your First Story</button>
                    </div>
                    <div class="stories-grid hidden" id="stories-grid">
                        <!-- Story cards will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Story Studio Page -->
    <div id="studio-page" class="app-page hidden">
        <div class="story-studio">
            <div class="studio-main">
                <div class="studio-header">
                    <button class="back-btn" onclick="showPage('library')" title="Back to Library">←</button>
                    <div class="studio-title">
                        <h2 id="studio-story-title">Story Title</h2>
                        <div class="studio-seed" id="studio-story-seed">Story seed appears here...</div>
                    </div>
                </div>
                <div class="story-messages" id="story-messages">
                    <!-- Messages will be populated here -->
                </div>
                <div class="story-input">
                    <textarea class="story-input-field" id="story-input" placeholder="Add your next scene or idea..." rows="1"></textarea>
                    <button class="send-btn" id="send-story-btn" title="Send message">✈️</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Page -->
    <div id="achievements-page" class="app-page hidden">
        <div class="page-header">
            <div class="container">
                <h1 class="page-title">Creative Achievements</h1>
                <p class="page-subtitle">Celebrate your storytelling journey</p>
            </div>
        </div>
        <div class="story-library">
            <div class="container">
                <div class="achievements-panel">
                    <div class="library-header">
                        <div>
                            <h2>🔥 Current Streak: <span id="current-streak">0</span> days</h2>
                            <p>Keep the creativity flowing!</p>
                        </div>
                    </div>
                    <div class="achievements-grid" id="all-achievements">
                        <!-- All achievements will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settings-page" class="app-page hidden">
        <div class="page-header">
            <div class="container">
                <h1 class="page-title">Settings</h1>
                <p class="page-subtitle">Customize your dreaming experience</p>
            </div>
        </div>
        <div class="story-library">
            <div class="container">
                <div class="achievements-panel">
                    <h3>🎨 Theme</h3>
                    <div class="achievements-grid">
                        <button class="achievement theme-btn" onclick="setTheme('twilight')" data-theme="twilight">
                            <div class="achievement-icon">🌅</div>
                            <div class="achievement-name">Twilight Dreams</div>
                            <div class="achievement-desc">Purple &amp; blue pastels</div>
                        </button>
                        <button class="achievement theme-btn" onclick="setTheme('sunrise')" data-theme="sunrise">
                            <div class="achievement-icon">🌞</div>
                            <div class="achievement-name">Sunrise Wonder</div>
                            <div class="achievement-desc">Warm oranges &amp; pinks</div>
                        </button>
                        <button class="achievement theme-btn" onclick="setTheme('midnight')" data-theme="midnight">
                            <div class="achievement-icon">🌙</div>
                            <div class="achievement-name">Midnight Magic</div>
                            <div class="achievement-desc">Deep blues with stars</div>
                        </button>
                    </div>
                </div>
                
                <div class="achievements-panel">
                    <h3>💾 Data Management</h3>
                    <button class="btn-secondary" onclick="exportAllStories()" style="margin-right: var(--space-sm);">📥 Export Stories</button>
                    <button class="btn-secondary" onclick="clearAllData()">🗑️ Clear All Data</button>
                    <p style="margin-top: var(--space-sm); font-size: 0.9rem; opacity: 0.7;">Export your stories as JSON or clear all app data</p>
                </div>
                
                <div class="achievements-panel">
                    <h3>ℹ️ About Daydreamer.ai</h3>
                    <p>Built for <strong>DubHacks 2025</strong> - "Play with ideas. Build what excites you."</p>
                    <p style="margin-top: var(--space-sm); font-style: italic;">"Where imagination meets AI" - Your playground for creativity.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- New Story Modal -->
    <div id="new-story-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">✨ Start a New Story</h2>
                <button class="close-btn" onclick="closeNewStoryModal()">&times;</button>
            </div>
            <form id="new-story-form">
                <div class="form-group">
                    <label class="form-label" for="story-title-input">Story Title *</label>
                    <input type="text" id="story-title-input" class="form-input" placeholder="The Enchanted Forest" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="story-seed-input">Your Story Plot *</label>
                    <input type="text" id="story-seed-input" class="form-input" placeholder="A dragon afraid of flying" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="story-description-input">Additional Details (Optional)</label>
                    <textarea id="story-description-input" class="form-textarea" placeholder="Add any extra context or inspiration for your story..."></textarea>
                </div>
                
                <div style="display: flex; gap: var(--space-sm);">
                    <button type="button" class="btn-secondary" onclick="closeNewStoryModal()" style="flex: 1;">Cancel</button>
                    <button type="submit" class="btn-primary" style="flex: 2;">Begin Writing ✨</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confetti Container -->
    <div id="confetti-container" class="confetti-container hidden"></div>
    
    <!-- Daily Mood Check-in Modal -->
    <div id="mood-modal" class="mood-modal hidden">
        <div class="mood-content">
            <h2 class="mood-title">How are you feeling today? 🌤️</h2>
            <p style="margin-bottom: var(--space-lg); color: var(--midnight-ink); opacity: 0.8;">Let's check in with your emotions!</p>
            
            <div class="mood-emojis" id="mood-emojis">
                <button class="mood-emoji" data-mood="1" data-emoji="😢">😢</button>
                <button class="mood-emoji" data-mood="2" data-emoji="😔">😔</button>
                <button class="mood-emoji" data-mood="3" data-emoji="😟">😟</button>
                <button class="mood-emoji" data-mood="4" data-emoji="😕">😕</button>
                <button class="mood-emoji" data-mood="5" data-emoji="😐">😐</button>
                <button class="mood-emoji" data-mood="6" data-emoji="🙂">🙂</button>
                <button class="mood-emoji" data-mood="7" data-emoji="😊">😊</button>
                <button class="mood-emoji" data-mood="8" data-emoji="😄">😄</button>
                <button class="mood-emoji" data-mood="9" data-emoji="😁">😁</button>
                <button class="mood-emoji" data-mood="10" data-emoji="🤩">🤩</button>
            </div>
            
            <textarea class="mood-note" id="mood-note" placeholder="What's on your mind today? (optional)"></textarea>
            
            <div style="display: flex; gap: var(--space-sm);">
                <button class="btn-secondary" onclick="closeMoodModal()" style="flex: 1;">Skip Today</button>
                <button class="btn-primary" onclick="saveMoodCheckIn()" style="flex: 2;" id="save-mood-btn" disabled>Save Check-in ✨</button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const CONFIG = {
            API_URL: 'https://dubhacks-25.onrender.com/api/chat',
            API_TIMEOUT: 40000,
            MIN_RESPONSE_DELAY: 1000
        };

        // Global App State (Using variables instead of localStorage due to sandbox restrictions)
        let currentUser = null;
        let appState = {
            stories: [],
            userData: {
                name: 'Dreamer',
                joinDate: new Date().toISOString().split('T')[0],
                currentStreak: 0,
                longestStreak: 0,
                lastActiveDate: null,
                totalWordsWritten: 0
            },
            achievements: [],
            settings: {
                theme: 'twilight',
                animationsEnabled: true,
                soundEnabled: false
            },
            moodTracking: {}
        };
        
        let currentStoryId = null;

        // Achievement Templates
        const achievementTemplates = [
            { id: 'first-story', name: 'First Story', icon: '📖', description: 'Start your first creative adventure', requirement: 1 },
            { id: 'daily-dreamer', name: 'Daily Dreamer', icon: '☀️', description: 'Write for 3 consecutive days', requirement: 3 },
            { id: 'dedicated-writer', name: 'Dedicated Writer', icon: '🔥', description: 'Keep the creativity flowing', requirement: 7 },
            { id: 'imagination-architect', name: 'Imagination Architect', icon: '🏗️', description: 'Build multiple worlds', requirement: 5 },
            { id: 'prolific-author', name: 'Prolific Author', icon: '✍️', description: 'Share your voice with the world', requirement: 100 },
            { id: 'plot-weaver', name: 'Plot Weaver', icon: '🕸️', description: 'Master storytelling depth', requirement: 50 }
        ];

        // Enhanced story seeds and daily prompts
        const sampleSeeds = [
            'A robot who dreams of being human',
            'A library where books come alive at night',
            'A painter who can step into their own paintings',
            'A dragon afraid of flying',
            'A detective who solves crimes in dreams',
            'A musician whose songs control the weather',
            'A gardener who grows memories instead of flowers',
            'An astronaut who discovers a planet of living clouds'
        ];
        

        
        const moodEmojis = {
            1: '😢', 2: '😔', 3: '😟', 4: '😕', 5: '😐',
            6: '🙂', 7: '😊', 8: '😄', 9: '😁', 10: '🤩'
        };
        
        const soundEffects = {
            sendMessage: '📝 Swoosh!',
            aiResponse: '✨ Sparkle!',
            achievement: '🎉 Hooray!',
            newStory: '☁️ Poof!',
            themeSwitch: '🌈 Tada!'
        };
        
        let currentMoodSelection = null;

        let lastMoodCheckDate = null; // Track last mood check date

        // Utility Functions
        function getCurrentDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString();
        }
        
        function getRandomSeed() {
            return sampleSeeds[Math.floor(Math.random() * sampleSeeds.length)];
        }

        // Page Management
        function showPage(pageName) {
            const pages = ['landing-page', 'library-page', 'studio-page', 'achievements-page', 'settings-page'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
            
            document.getElementById(pageName + '-page').classList.remove('hidden');
            
            // Update page-specific content
            if (pageName === 'library') updateStoryLibrary();
            if (pageName === 'achievements') updateAchievementsPage();
            if (pageName === 'settings') updateSettingsPage();
        }

        // First-time user flow
        function startFirstStory() {
            if (!currentUser) {
                const name = prompt('Welcome to Daydreamer.ai! What should we call you?') || 'Dreamer';
                currentUser = { name };
                appState.userData.name = name;
                updateNavigation();
                
                // Check for daily mood check-in after a short delay
                setTimeout(() => {
                    checkDailyMoodCheckIn();
                }, 1000);
            }
            
            openNewStoryModal();
        }

        function updateNavigation() {
            if (currentUser) {
                document.getElementById('nav-library').classList.remove('hidden');
                document.getElementById('nav-achievements').classList.remove('hidden');
                document.getElementById('nav-settings').classList.remove('hidden');
                
                document.getElementById('cta-button').classList.add('hidden');
                document.getElementById('user-greeting').classList.remove('hidden');
                document.getElementById('user-greeting').textContent = `${currentUser.name} ✨`;
                
                // Check for daily mood check-in
                setTimeout(() => {
                    checkDailyMoodCheckIn();
                }, 500);
            }
        }

        // Story Management
        function openNewStoryModal() {
            document.getElementById('story-title-input').value = '';
            document.getElementById('story-seed-input').value = '';
            document.getElementById('story-description-input').value = '';
            document.getElementById('story-seed-input').placeholder = getRandomSeed();
            document.getElementById('new-story-modal').classList.remove('hidden');
            document.getElementById('story-title-input').focus();
        }

        function closeNewStoryModal() {
            document.getElementById('new-story-modal').classList.add('hidden');
        }

        document.getElementById('new-story-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createNewStory();
        });

        function createNewStory() {
            const title = document.getElementById('story-title-input').value.trim();
            const seed = document.getElementById('story-seed-input').value.trim() || document.getElementById('story-seed-input').placeholder;
            const description = document.getElementById('story-description-input').value.trim();
            
            if (!title) {
                alert('Every great story needs a title!');
                return;
            }
            
            const storyId = generateId();
            const newStory = {
                id: storyId,
                title: title,
                seed: seed,
                messages: [],
                createdDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                wordCount: 0
            };
            
            appState.stories.push(newStory);
            
            // Check for first story achievement
            if (appState.stories.length === 1) {
                unlockAchievement('first-story');
            }
            
            closeNewStoryModal();
            openStoryStudio(storyId);
        }

        function openStoryStudio(storyId) {
            currentStoryId = storyId;
            const story = appState.stories.find(s => s.id === storyId);
            
            if (!story) return;
            
            document.getElementById('studio-story-title').textContent = story.title;
            document.getElementById('studio-story-seed').textContent = story.seed;
            
            // Populate existing messages
            const messagesContainer = document.getElementById('story-messages');
            messagesContainer.innerHTML = '';
            
            story.messages.forEach(msg => {
                addStoryMessage(msg.text, msg.sender === 'user');
            });
            
            showPage('studio');
            
            // Add welcome message if this is a new story
            if (story.messages.length === 0) {
                setTimeout(() => {
                    const welcomeMsg = `Let's bring "${story.seed}" to life! Start us off with your opening scene, and I'll help weave the tale with you. ✨`;
                    addStoryMessage(welcomeMsg, false);
                    
                    // Save the welcome message
                    story.messages.push({
                        id: generateId(),
                        sender: 'ai',
                        text: welcomeMsg,
                        timestamp: new Date().toISOString()
                    });
                }, 500);
            }
        }

        function deleteStory(storyId) {
            if (!confirm('Are you sure you want to delete this story? This action cannot be undone.')) {
                return;
            }
            
            appState.stories = appState.stories.filter(s => s.id !== storyId);
            updateStoryLibrary();
        }

        function updateStoryLibrary() {
            const container = document.getElementById('stories-container');
            const emptyState = document.getElementById('empty-state');
            const storiesGrid = document.getElementById('stories-grid');
            
            if (appState.stories.length === 0) {
                emptyState.classList.remove('hidden');
                storiesGrid.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                storiesGrid.classList.remove('hidden');
                
                storiesGrid.innerHTML = '';
                
                appState.stories.forEach(story => {
                    const storyCard = document.createElement('div');
                    storyCard.className = 'story-card';
                    storyCard.innerHTML = `
                        <div class="story-title">${story.title}</div>
                        <div class="story-seed">"${story.seed}"</div>
                        <div class="story-meta">
                            <span>${story.messages.length} messages</span>
                            <span>${formatDate(story.lastUpdated)}</span>
                        </div>
                        <div class="story-actions">
                            <button class="continue-btn btn-bounce" onclick="openStoryStudio('${story.id}')">Continue Story</button>
                            <button class="delete-btn" onclick="deleteStory('${story.id}')" title="Delete story">🗑️</button>
                        </div>
                    `;
                    storiesGrid.appendChild(storyCard);
                });
            }
            
            updateRecentAchievements();
        }

        // Story Studio Chat
        document.getElementById('story-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendStoryMessage();
            }
        });

        document.getElementById('send-story-btn').addEventListener('click', sendStoryMessage);
        
        // Mood check-in event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Add mood emoji click handlers
            document.querySelectorAll('.mood-emoji').forEach(emoji => {
                emoji.addEventListener('click', () => {
                    // Remove previous selection
                    document.querySelectorAll('.mood-emoji').forEach(e => e.classList.remove('selected'));
                    
                    // Select current emoji
                    emoji.classList.add('selected');
                    currentMoodSelection = {
                        mood: parseInt(emoji.dataset.mood),
                        emoji: emoji.dataset.emoji
                    };
                    
                    // Enable save button
                    document.getElementById('save-mood-btn').disabled = false;
                    
                    // Show visual sound effect
                    showSoundEffect(emoji, '✨');
                });
            });
        });

        async function sendStoryMessage() {
            const input = document.getElementById('story-input');
            const message = input.value.trim();
            
            if (!message || !currentStoryId) return;
            
            const story = appState.stories.find(s => s.id === currentStoryId);
            if (!story) return;
            
            // Add user message
            addStoryMessage(message, true);
            input.value = '';
            
            // Show visual sound effect
            showSoundEffect(document.getElementById('send-story-btn'), soundEffects.sendMessage);
            
            // Store user message
            story.messages.push({
                id: generateId(),
                sender: 'user',
                text: message,
                timestamp: new Date().toISOString()
            });
            
            // Update word count
            appState.userData.totalWordsWritten += message.split(' ').length;
            
            // Show paper airplane animation
            showPaperAirplaneAnimation();
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Build context for AI
                const context = `Story: "${story.title}" - ${story.seed}\n\nContinue this collaborative story. The user just wrote: "${message}"\n\nRespond as the AI storyteller, building naturally on their contribution while maintaining the story's tone and direction.`;
                
                const aiResponse = await generateAIResponse(context);
                
                hideTypingIndicator();
                addStoryMessage(aiResponse, false);
                
                // Show AI response sound effect
                setTimeout(() => {
                    showSoundEffect(document.getElementById('story-messages'), soundEffects.aiResponse);
                }, 500);
                
                // Store AI message
                story.messages.push({
                    id: generateId(),
                    sender: 'ai',
                    text: aiResponse,
                    timestamp: new Date().toISOString()
                });
                
                // Update story metadata
                story.lastUpdated = new Date().toISOString();
                story.wordCount = story.messages.reduce((count, msg) => count + msg.text.split(' ').length, 0);
                
                // Check achievements
                checkWritingAchievements();
                
            } catch (error) {
                console.error('Error generating AI response:', error);
                hideTypingIndicator();
                addStoryMessage("The AI is dreaming... Try again soon! 🌙", false);
            }
        }

        function addStoryMessage(text, isUser) {
            const messagesContainer = document.getElementById('story-messages');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isUser ? 'user' : 'ai'}`;
            messageElement.textContent = text;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('story-messages');
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typing-indicator';
            indicator.innerHTML = `
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            
            messagesContainer.appendChild(indicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function showPaperAirplaneAnimation() {
            const sendBtn = document.getElementById('send-story-btn');
            const rect = sendBtn.getBoundingClientRect();
            
            const airplane = document.createElement('div');
            airplane.className = 'airplane-animation';
            airplane.textContent = '✈️';
            airplane.style.left = rect.left + 'px';
            airplane.style.top = rect.top + 'px';
            
            document.body.appendChild(airplane);
            
            setTimeout(() => {
                airplane.remove();
            }, 1000);
        }

        // AI Response Generation
        async function generateAIResponse(userMessage) {
            const startTime = Date.now();
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), CONFIG.API_TIMEOUT);
                
                const response = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                
                const elapsed = Date.now() - startTime;
                if (elapsed < CONFIG.MIN_RESPONSE_DELAY) {
                    await new Promise(resolve => setTimeout(resolve, CONFIG.MIN_RESPONSE_DELAY - elapsed));
                }
                
                return data.reply || "The AI is taking a creative break... Try again!";
                
            } catch (error) {
                console.error('Error calling API:', error);
                
                if (error.name === 'AbortError') {
                    return "The request took too long. Please try again.";
                }
                
                if (error.message.includes('fetch')) {
                    return "Unable to connect to AI service. Please ensure the backend is running at http://localhost:3001";
                }
                
                return "I'm having trouble processing your message right now. Please try again.";
            }
        }

        // Achievements System
        function unlockAchievement(achievementId) {
            if (appState.achievements.includes(achievementId)) return;
            
            appState.achievements.push(achievementId);
            
            const achievement = achievementTemplates.find(a => a.id === achievementId);
            if (achievement) {
                showAchievementUnlock(achievement);
            }
        }

        function showAchievementUnlock(achievement) {
            showConfetti();
            
            // Show visual sound effect
            setTimeout(() => {
                showSoundEffect(
                    document.body,
                    soundEffects.achievement
                );
            }, 200);
            
            setTimeout(() => {
                alert(`🎉 Achievement Unlocked!\n\n${achievement.icon} ${achievement.name}\n${achievement.description}`);
            }, 800);
        }

        function checkWritingAchievements() {
            const totalMessages = appState.stories.reduce((total, story) => total + story.messages.filter(m => m.sender === 'user').length, 0);
            
            // Prolific Author - 100 total messages
            if (totalMessages >= 100 && !appState.achievements.includes('prolific-author')) {
                unlockAchievement('prolific-author');
            }
            
            // Imagination Architect - 5 stories
            if (appState.stories.length >= 5 && !appState.achievements.includes('imagination-architect')) {
                unlockAchievement('imagination-architect');
            }
            
            // Plot Weaver - 50 messages in one story
            const maxStoryMessages = Math.max(...appState.stories.map(s => s.messages.filter(m => m.sender === 'user').length));
            if (maxStoryMessages >= 50 && !appState.achievements.includes('plot-weaver')) {
                unlockAchievement('plot-weaver');
            }
            
            // Daily streaks (simplified for demo)
            const today = getCurrentDate();
            if (appState.userData.lastActiveDate !== today) {
                appState.userData.currentStreak = 1;
                appState.userData.lastActiveDate = today;
                
                if (appState.userData.currentStreak >= 3 && !appState.achievements.includes('daily-dreamer')) {
                    unlockAchievement('daily-dreamer');
                }
                
                if (appState.userData.currentStreak >= 7 && !appState.achievements.includes('dedicated-writer')) {
                    unlockAchievement('dedicated-writer');
                }
            }
        }

        function updateRecentAchievements() {
            const container = document.getElementById('recent-achievements');
            container.innerHTML = '';
            
            const recentAchievements = appState.achievements.slice(-3);
            
            if (recentAchievements.length === 0) {
                container.innerHTML = '<div style="text-align: center; opacity: 0.7; grid-column: 1/-1;">Start writing to unlock achievements! ✨</div>';
                return;
            }
            
            recentAchievements.forEach(achId => {
                const achievement = achievementTemplates.find(a => a.id === achId);
                if (achievement) {
                    const achElement = document.createElement('div');
                    achElement.className = 'achievement unlocked';
                    achElement.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    `;
                    container.appendChild(achElement);
                }
            });
        }

        function updateAchievementsPage() {
            document.getElementById('current-streak').textContent = appState.userData.currentStreak;
            
            const container = document.getElementById('all-achievements');
            container.innerHTML = '';
            
            achievementTemplates.forEach(achievement => {
                const isUnlocked = appState.achievements.includes(achievement.id);
                const achElement = document.createElement('div');
                achElement.className = `achievement ${isUnlocked ? 'unlocked' : 'locked'}`;
                achElement.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.description}</div>
                `;
                container.appendChild(achElement);
            });
            
            // Add stats panel if it doesn't exist
            addStatsPanel();
        }
        
        function addStatsPanel() {
            const existingStats = document.getElementById('stats-panel');
            if (existingStats) existingStats.remove();
            
            const stats = updateUserStats();
            const achievementsPage = document.getElementById('achievements-page');
            const container = achievementsPage.querySelector('.container');
            
            const statsPanel = document.createElement('div');
            statsPanel.id = 'stats-panel';
            statsPanel.className = 'achievements-panel';
            statsPanel.style.marginTop = 'var(--space-lg)';
            
            statsPanel.innerHTML = `
                <h3>📊 Your Writing Journey</h3>
                <div class="achievements-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                    <div class="achievement unlocked" style="background: var(--fun-green); color: white;">
                        <div class="achievement-icon">📝</div>
                        <div class="achievement-name">${stats.totalWords}</div>
                        <div class="achievement-desc">Total Words</div>
                    </div>
                    <div class="achievement unlocked" style="background: var(--sky-blue); color: white;">
                        <div class="achievement-icon">📚</div>
                        <div class="achievement-name">${stats.storiesCount}</div>
                        <div class="achievement-desc">Stories Created</div>
                    </div>
                    <div class="achievement unlocked" style="background: var(--crayon-pink); color: white;">
                        <div class="achievement-icon">💬</div>
                        <div class="achievement-name">${stats.totalMessages}</div>
                        <div class="achievement-desc">Messages Sent</div>
                    </div>
                    <div class="achievement unlocked" style="background: var(--lavender-dreams); color: var(--midnight-ink);">
                        <div class="achievement-icon">😊</div>
                        <div class="achievement-name">${stats.moodEntries}</div>
                        <div class="achievement-desc">Mood Check-ins</div>
                    </div>
                </div>
            `;
            
            container.appendChild(statsPanel);
        }

        // Enhanced Theme Management
        function setTheme(theme) {
            appState.settings.theme = theme;
            
            // Remove existing theme classes
            document.body.classList.remove('theme-twilight', 'theme-sunrise', 'theme-midnight');
            
            // Apply new theme
            if (theme !== 'twilight') {
                document.body.classList.add(`theme-${theme}`);
            }
            
            // Update active theme button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('unlocked');
            });
            document.querySelector(`[data-theme="${theme}"]`).classList.add('unlocked');
            
            // Show theme switch effect
            showSoundEffect(
                document.querySelector(`[data-theme="${theme}"]`),
                soundEffects.themeSwitch
            );
        }

        function updateSettingsPage() {
            // Set active theme
            setTheme(appState.settings.theme);
        }

        // Data Management
        function exportAllStories() {
            const exportData = {
                user: currentUser,
                stories: appState.stories,
                userData: appState.userData,
                achievements: appState.achievements,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `daydreamer-stories-${getCurrentDate()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function clearAllData() {
            if (!confirm('Are you sure you want to clear all your stories and data? This action cannot be undone.')) {
                return;
            }
            
            // Reset app state
            appState = {
                stories: [],
                userData: {
                    name: 'Dreamer',
                    joinDate: new Date().toISOString().split('T')[0],
                    currentStreak: 0,
                    longestStreak: 0,
                    lastActiveDate: null
                },
                achievements: [],
                settings: {
                    theme: 'twilight',
                    animationsEnabled: true,
                    soundEnabled: false
                }
            };
            
            currentUser = null;
            currentStoryId = null;
            
            // Update UI
            document.getElementById('nav-library').classList.add('hidden');
            document.getElementById('nav-achievements').classList.add('hidden');
            document.getElementById('nav-settings').classList.add('hidden');
            document.getElementById('cta-button').classList.remove('hidden');
            document.getElementById('user-greeting').classList.add('hidden');
            
            showPage('landing');
            alert('All data cleared successfully!');
        }

        // Enhanced Confetti Animation
        function showConfetti() {
            const container = document.getElementById('confetti-container');
            container.classList.remove('hidden');
            
            const colors = ['#FFD700', '#FF69B4', '#5DC1FF', '#C9A0FF', '#4ADE80', '#FFE135'];
            const shapes = ['circle', 'star', 'square'];
            
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                confetti.className = `confetti ${shape}`;
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.8 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2.5) + 's';
                
                // Add some horizontal movement
                const randomX = (Math.random() - 0.5) * 200;
                confetti.style.setProperty('--random-x', randomX + 'px');
                
                container.appendChild(confetti);
            }
            
            setTimeout(() => {
                container.classList.add('hidden');
                container.innerHTML = '';
            }, 4500);
        }
        
        // Visual Sound Effects
        function showSoundEffect(targetElement, text) {
            const rect = targetElement.getBoundingClientRect();
            const effect = document.createElement('div');
            effect.className = 'sound-effect';
            effect.textContent = text;
            effect.style.left = (rect.left + rect.width / 2) + 'px';
            effect.style.top = (rect.top - 10) + 'px';
            
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 2000);
        }
        
        // Daily Mood Check-in System
        function checkDailyMoodCheckIn() {
            const today = getCurrentDate();
            
            // Check if user has already checked in today
            if (lastMoodCheckDate !== today && !appState.moodTracking[today]) {
                setTimeout(() => {
                    document.getElementById('mood-modal').classList.remove('hidden');
                }, 1500);
            }
        }
        
        function closeMoodModal() {
            document.getElementById('mood-modal').classList.add('hidden');
            currentMoodSelection = null;
            // Mark that user has seen the modal today (even if they skipped)
            lastMoodCheckDate = getCurrentDate();
            
            // Reset UI state
            document.querySelectorAll('.mood-emoji').forEach(e => e.classList.remove('selected'));
            document.getElementById('mood-note').value = '';
            document.getElementById('save-mood-btn').disabled = true;
        }
        
        function saveMoodCheckIn() {
            if (!currentMoodSelection) return;
            
            const today = getCurrentDate();
            const note = document.getElementById('mood-note').value.trim();
            
            appState.moodTracking[today] = {
                mood: currentMoodSelection.mood,
                emoji: currentMoodSelection.emoji,
                note: note,
                timestamp: new Date().toISOString()
            };
            
            // Mark that user checked in today
            lastMoodCheckDate = today;
            
            // Update streak if applicable
            updateMoodStreak();
            
            // Show success animation
            showSoundEffect(
                document.getElementById('save-mood-btn'), 
                '✨ Thanks for sharing!'
            );
            
            setTimeout(() => {
                closeMoodModal();
            }, 800);
        }
        
        function updateMoodStreak() {
            const today = getCurrentDate();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            
            if (appState.userData.lastActiveDate === yesterdayStr || 
                appState.userData.lastActiveDate === today) {
                appState.userData.currentStreak = Math.max(1, appState.userData.currentStreak + 1);
            } else {
                appState.userData.currentStreak = 1;
            }
            
            appState.userData.lastActiveDate = today;
            appState.userData.longestStreak = Math.max(
                appState.userData.longestStreak, 
                appState.userData.currentStreak
            );
        }
        


        // Enhanced Stats for Profile
        function updateUserStats() {
            const totalMessages = appState.stories.reduce((total, story) => 
                total + story.messages.filter(m => m.sender === 'user').length, 0
            );
            
            const totalWords = appState.userData.totalWordsWritten;
            const storiesCount = appState.stories.length;
            const moodEntries = Object.keys(appState.moodTracking).length;
            
            return {
                totalMessages,
                totalWords,
                storiesCount,
                moodEntries,
                currentStreak: appState.userData.currentStreak,
                longestStreak: appState.userData.longestStreak
            };
        }
        
        // Enhanced button interactions
        function addButtonBounce() {
            document.querySelectorAll('.new-story-btn, .continue-btn, .btn-primary, .btn-secondary').forEach(btn => {
                if (!btn.classList.contains('btn-bounce')) {
                    btn.classList.add('btn-bounce');
                }
            });
        }
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            showPage('landing');
            
            // Add enhanced button interactions
            setTimeout(() => {
                addButtonBounce();
                
                // Check for returning user and show mood check-in
                if (currentUser && Object.keys(appState.moodTracking).length > 0) {
                    checkDailyMoodCheckIn();
                }
            }, 1000);
            
            // Initialize with some sample data for demo
            if (window.location.search.includes('demo=true')) {
                initializeDemoData();
            }
        });
        
        function initializeDemoData() {
            currentUser = { name: 'Demo Dreamer' };
            appState.userData.name = 'Demo Dreamer';
            appState.userData.totalWordsWritten = 150;
            
            // Add sample mood data
            const today = getCurrentDate();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            appState.moodTracking[today] = {
                mood: 8,
                emoji: '😄',
                note: 'Feeling creative and inspired!',
                timestamp: new Date().toISOString()
            };
            
            appState.moodTracking[yesterday.toISOString().split('T')[0]] = {
                mood: 7,
                emoji: '😊',
                note: 'Had a great writing session.',
                timestamp: yesterday.toISOString()
            };
            
            // Set lastMoodCheckDate so demo user doesn't see modal immediately
            lastMoodCheckDate = today;
            
            // Add a sample story
            const sampleStory = {
                id: 'demo-story-1',
                title: 'The Cloud Whisperer',
                seed: 'A child who can speak to clouds',
                messages: [
                    {
                        id: 'msg1',
                        sender: 'ai',
                        text: 'Let\'s bring "A child who can speak to clouds" to life! Start us off with your opening scene, and I\'ll help weave the tale with you. ✨',
                        timestamp: new Date().toISOString()
                    },
                    {
                        id: 'msg2',
                        sender: 'user',
                        text: 'Little Maya sat on the hillside, watching the clouds drift by. She had discovered her gift last week - the ability to hear their whispered secrets.',
                        timestamp: new Date().toISOString()
                    },
                    {
                        id: 'msg3',
                        sender: 'ai',
                        text: 'The clouds above swirled gently, and Maya heard their soft, silvery voices carried on the wind. "Storm coming tomorrow," whispered a fluffy cumulus. "The farmer\'s crops will drink well." Maya smiled, knowing she was the only one who could hear their ancient wisdom.',
                        timestamp: new Date().toISOString()
                    }
                ],
                createdDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                wordCount: 67
            };
            
            appState.stories.push(sampleStory);
            appState.achievements.push('first-story');
            appState.userData.currentStreak = 2;
            
            updateNavigation();
        }
    </script>
</body>
</html>